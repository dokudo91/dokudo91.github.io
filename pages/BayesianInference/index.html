<!doctype html> <html lang=ja > <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <link rel=stylesheet  href="/libs/katex/katex.min.css"> <link rel=stylesheet  href="/libs/highlight/github.min.css"> <meta name="twitter:card" content=summary > <meta name="twitter:title" content="Juliaの世界 |&gt; ベイズ推定"> <meta name="twitter:site" content="@dokudo91"> <meta name="twitter:description" content="Juliaでベイズ推定を扱う。"> <meta name="twitter:image" content="https://dokudo91.github.io/assets/ソフィーの世界.png"> <link rel=stylesheet  href="/css/franklin.css"> <link rel=stylesheet  href="/css/basic.css"> <link rel=icon  href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text x=%220%22 y=%2280%22 font-family=%22Arial%22 font-size=%2285%22>😀</text></svg>"> <title>ベイズ推定</title> <header> <div class=blog-name ><a href="/">Juliaの世界</a></div> </header> <div class=franklin-content ><h1 id="ベイズ推定"><a href="#ベイズ推定" class=header-anchor >ベイズ推定</a></h1> <p>Juliaでベイズ推定を扱う。 推定を行いたいパラメータをθ、観測データをyとするとθとyの同時確率分布は</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mi>p</mi><mo stretchy=false >(</mo><mi>θ</mi><mo separator=true >,</mo><mi>y</mi><mo stretchy=false >)</mo><mo>=</mo><mi>p</mi><mo stretchy=false >(</mo><mi>θ</mi><mo stretchy=false >)</mo><mi>p</mi><mo stretchy=false >(</mo><mi>y</mi><mi mathvariant=normal >∣</mi><mi>θ</mi><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex"> p(θ, y) = p(θ)p(y|θ) </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">p</span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">p</span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=mclose >)</span><span class="mord mathnormal">p</span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=mord >∣</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=mclose >)</span></span></span></span></span> <p>で表される。 <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo stretchy=false >(</mo><mi>θ</mi><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">p(θ)</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">p</span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=mclose >)</span></span></span></span>はθの事前分布の確率密度関数であり、推定者の事前のθに対する信念を反映する。 <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo stretchy=false >(</mo><mi>y</mi><mi mathvariant=normal >∣</mi><mi>θ</mi><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">p(y|θ)</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">p</span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=mord >∣</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=mclose >)</span></span></span></span>は尤度関数であり、特定の値θが与えられたとき、観測データyの確率密度関数&#40;PDF&#41;である。 <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo stretchy=false >(</mo><mi>θ</mi><mo separator=true >,</mo><mi>y</mi><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">p(θ, y)</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">p</span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=mclose >)</span></span></span></span>はθとyが同時に特定の値をとる同時確率分布の確率密度関数である。</p> <h2 id="事後確率"><a href="#事後確率" class=header-anchor >事後確率</a></h2> <p>事後確率は</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mi>p</mi><mo stretchy=false >(</mo><mi>θ</mi><mi mathvariant=normal >∣</mi><mi>y</mi><mo stretchy=false >)</mo><mo>=</mo><mfrac><mrow><mi>p</mi><mo stretchy=false >(</mo><mi>θ</mi><mo separator=true >,</mo><mi>y</mi><mo stretchy=false >)</mo></mrow><mrow><mi>p</mi><mo stretchy=false >(</mo><mi>y</mi><mo stretchy=false >)</mo></mrow></mfrac><mo>=</mo><mfrac><mrow><mi>p</mi><mo stretchy=false >(</mo><mi>y</mi><mi mathvariant=normal >∣</mi><mi>θ</mi><mo stretchy=false >)</mo><mi>p</mi><mo stretchy=false >(</mo><mi>θ</mi><mo stretchy=false >)</mo></mrow><mrow><mi>p</mi><mo stretchy=false >(</mo><mi>y</mi><mo stretchy=false >)</mo></mrow></mfrac></mrow><annotation encoding="application/x-tex"> p(θ|y) = \frac{p(θ, y)}{p(y)} = \frac{p(y|θ)p(θ)}{p(y)} </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">p</span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=mord >∣</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:2.363em;vertical-align:-0.936em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.427em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal">p</span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=mclose >)</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal">p</span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=mclose >)</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:2.363em;vertical-align:-0.936em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.427em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal">p</span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=mclose >)</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal">p</span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=mord >∣</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=mclose >)</span><span class="mord mathnormal">p</span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=mclose >)</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span> <p>である。<span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo stretchy=false >(</mo><mi>y</mi><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">p(y)</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">p</span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=mclose >)</span></span></span></span>は周辺尤度であり、<span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo stretchy=false >(</mo><mi>y</mi><mo stretchy=false >)</mo><mo>=</mo><mo>∫</mo><mi>p</mi><mo stretchy=false >(</mo><mi>θ</mi><mo separator=true >,</mo><mi>y</mi><mo stretchy=false >)</mo><mi>d</mi><mi>θ</mi></mrow><annotation encoding="application/x-tex">p(y) = ∫ p(θ, y) dθ</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">p</span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1.11112em;vertical-align:-0.30612em;"></span><span class="mop op-symbol small-op" style="margin-right:0.19445em;position:relative;top:-0.0005599999999999772em;">∫</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">p</span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=mclose >)</span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span></span></span></span>である。</p> <h2 id="具体例コイントス"><a href="#具体例コイントス" class=header-anchor >具体例：コイントス</a></h2> <p>コイントスを例にベイズ推定を行う。コインは歪んでおり、表が出る確率は全くわからない。そしてこのコインの表が出る確率θをベイズ推定したい。</p> <h3 id="事前確率_pθ"><a href="#事前確率_pθ" class=header-anchor >事前確率 p&#40;θ&#41;</a></h3> <p>表が出る確率は0から1でフラットに考えているので、コインの表が出る確率の事前確率は0から1の一様分布とする。</p> <pre><code class=language-julia >using Distributions, StatsPlots
prior_distribution &#61; Uniform&#40;0,1&#41;

plot&#40;prior_distribution, xlims&#61;&#40;-0.1,1.1&#41;, ylims&#61;&#40;0,1.5&#41;, label&#61;&quot;PDF&quot;, ylabel&#61;&quot;#&quot;&#41;
savefig&#40;joinpath&#40;@OUTPUT, &quot;prior_distribution.svg&quot;&#41;&#41;
@show pdf&#40;prior_distribution, 0.1&#41; # p&#40;θ&#61;0.1&#41; &#61; 1</code></pre> <p><img src="/assets/pages/BayesianInference/code/bayes/output/prior_distribution.svg" alt=""> <pre><code class="plaintext code-output">pdf(prior_distribution, 0.1) = 1.0
</code></pre></p> <h3 id="尤度関数_pyθ"><a href="#尤度関数_pyθ" class=header-anchor >尤度関数 p&#40;y|θ&#41;</a></h3> <p>コイントスを10回行い、表が出た回数yを測定する。 表が出る確率がθで、コイントスを10回行った時に表が出る確率分布は二項分布<code>Binomial&#40;10, θ&#41;</code>で表される。 θは確率変数なのでθを変数とした関数を定義する。</p> <pre><code class=language-julia >sampling_distribution&#40;θ&#41; &#61; Binomial&#40;10, θ&#41;

plot&#40;sampling_distribution&#40;0.1&#41;, xticks&#61;0:1:10, label&#61;&quot;PMF&quot;, ylabel&#61;&quot;#&quot;&#41;
savefig&#40;joinpath&#40;@OUTPUT, &quot;sampling_distribution.svg&quot;&#41;&#41;
@show pdf&#40;sampling_distribution&#40;0.1&#41;, 3&#41; # p&#40;y&#61;3|θ&#61;0.1&#41;</code></pre> <p>θ&#61;0.1の時の確率質量関数&#40;PMF&#41;のグラフは以下のようになる。 <img src="/assets/pages/BayesianInference/code/bayes/output/sampling_distribution.svg" alt=""></p> <p>θ&#61;0.1の時にy&#61;3となる確率は <pre><code class="plaintext code-output">pdf(sampling_distribution(0.1), 3) = 0.05739562800000017
</code></pre> である。</p> <h3 id="同時確率_pθ_ypθpyθ"><a href="#同時確率_pθ_ypθpyθ" class=header-anchor >同時確率 p&#40;θ, y&#41;&#61;p&#40;θ&#41;p&#40;y∣θ&#41;</a></h3> <p>同時確率は</p> <pre><code class=language-julia >joint_probability&#40;θ, y&#41; &#61; pdf&#40;prior_distribution, θ&#41; * pdf&#40;sampling_distribution&#40;θ&#41;, y&#41; # p&#40;θ, y&#41; &#61; p&#40;θ&#41;p&#40;y∣θ&#41;
@show joint_probability&#40;0.1, 3&#41; # p&#40;θ&#61;0.1, y&#61;3&#41;
@show joint_probability&#40;0.3, 3&#41; # p&#40;θ&#61;0.3, y&#61;3&#41;</code></pre> <p>となる。 <pre><code class="plaintext code-output">joint_probability(0.1, 3) = 0.05739562800000017
joint_probability(0.3, 3) = 0.2668279320000006
</code></pre></p> <p>コイントスを10回して表が3回出たとすると、そのコインの表が出る確率θが0.1である確率密度は0.057であり、θが0.3である確率密度は0.267である。</p> <pre><code class=language-julia >joint_probabilities&#61;&#91;joint_probability&#40;θ,3&#41; for θ in 0:0.01:1&#93;
plot&#40;0:0.01:1, joint_probabilities, label&#61;&quot;PDF&quot;, ylabel&#61;&quot;#&quot;&#41;
savefig&#40;joinpath&#40;@OUTPUT, &quot;joint_probabilities.svg&quot;&#41;&#41;
@show &#40;argmax&#40;joint_probabilities&#41; - 1&#41; * 0.01</code></pre> <p>y&#61;3の時のθの確率分布は以下のようになる。 <img src="/assets/pages/BayesianInference/code/bayes/output/joint_probabilities.svg" alt=""></p> <p>最大値をとるインデックスはargmaxで取得できる。 <pre><code class="plaintext code-output">(argmax(joint_probabilities) - 1) * 0.01 = 0.3
</code></pre> PDFはθ&#61;0.3の時に最大となっている。</p> <h3 id="周辺確率_pypθydθ"><a href="#周辺確率_pypθydθ" class=header-anchor >周辺確率 p&#40;y&#41;&#61;∫p&#40;θ,y&#41;dθ</a></h3> <p>周辺確率は同時確率をθで積分することで計算できる。</p> <pre><code class=language-julia >marginal_likelihood&#40;y&#41;&#61;sum&#40;joint_probability&#40;θ,y&#41;*0.01 for θ in 0:0.01:1&#41;
@show marginal_likelihood&#40;1&#41;
@show marginal_likelihood&#40;3&#41;
@show marginal_likelihood&#40;5&#41;</code></pre> <p><pre><code class="plaintext code-output">marginal_likelihood(1) = 0.09082578757075802
marginal_likelihood(3) = 0.09090910089909292
marginal_likelihood(5) = 0.09090909090709313
</code></pre> 事前確率が一様分布なので周辺確率に違いはない。</p> <h3 id="事後確率_pθypθypy"><a href="#事後確率_pθypθypy" class=header-anchor >事後確率 p&#40;θ|y&#41;&#61;p&#40;θ,y&#41;/p&#40;y&#41;</a></h3> <p>事後確率は</p> <pre><code class=language-julia >posterior_probability&#40;θ,y&#41;&#61;joint_probability&#40;θ,y&#41;/marginal_likelihood&#40;y&#41;</code></pre>
<p>となる。その確率分布は</p>
<pre><code class=language-julia >posterior_density&#61;&#91;posterior_probability&#40;θ,3&#41; for θ in 0:0.01:1&#93;
plot&#40;0:0.01:1, posterior_density, label&#61;&quot;PDF&quot;, ylabel&#61;&quot;#&quot;&#41;
savefig&#40;joinpath&#40;@OUTPUT, &quot;posterior_density.svg&quot;&#41;&#41;</code></pre>
<img src="/assets/pages/BayesianInference/code/bayes/output/posterior_density.svg" alt="">
<p>となる。コインの表が出る確率θに対して、0&#37;から100&#37;まで一様分布していた信念が、コイントスを10回して表が3回出たため、このような確率分布に更新された。</p>
<p>この確率分布を積分した値は正しく1になっている。</p>
<pre><code class=language-julia >@show sum&#40;posterior_density * 0.01&#41;</code></pre>
<p><pre><code class="plaintext code-output">sum(posterior_density * 0.01) = 1.0000000000000002
</code></pre> Juliaはブロードキャスティングを言語仕様でサポートしているので、<code>posterior_density * 0.01</code>は配列posterior_densityの全ての要素に0.01を掛ける操作となる。</p>
<div class=page-foot >
  <div class=copyright >
    &copy; dokudo91. Last modified: September 06, 2023. Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and the <a href="https://julialang.org">Julia programming language</a>.
  </div>
</div>
</div>
    
        



    
    
        <script src="/libs/highlight/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();hljs.configure({tabReplace: '    '});</script>