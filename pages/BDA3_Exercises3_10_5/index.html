<!doctype html> <html lang=ja > <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <link rel=stylesheet  href="/libs/katex/katex.min.css"> <link rel=stylesheet  href="/libs/highlight/github.min.css"> <meta name="twitter:card" content=summary > <meta name="twitter:title" content="Juliaの世界 |&gt; BDA3の3.10 Exercisesの4を解く"> <meta name="twitter:site" content="@dokudo91"> <meta name="twitter:description" content="BDA3の3.10 Exercisesの4を解く。"> <meta name="twitter:image" content="https://dokudo91.github.io/assets/ソフィーの世界.png"> <link rel=stylesheet  href="/css/franklin.css"> <link rel=stylesheet  href="/css/basic.css"> <link rel=icon  href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text x=%220%22 y=%2280%22 font-family=%22Arial%22 font-size=%2285%22>😀</text></svg>"> <title>BDA3の3.10 Exercisesの4を解く</title> <header> <div class=blog-name ><a href="/">Juliaの世界</a></div> </header> <div class=franklin-content ><p>BDA3の3.10 Exercisesの4を解く。 本文は<a href="http://www.stat.columbia.edu/~gelman/book/">Bayesian Data Analysis</a>。 解答参考は<a href="http://www.stat.columbia.edu/~gelman/book/BDA3.pdf">Solutions to some exercises from Bayesian Data Analysis</a>。</p> <h1 id=ol_start5_rounded_data ><a href="#ol_start5_rounded_data" class=header-anchor ><ol start=5 > <li><p>Rounded data</p> </ol> </a></h1> <p>工場で5つの製品の重さを測った。 その値は四捨五入して、y&#61;&#91;10, 10, 12, 11, 9&#93;だった。 四捨五入しない本当の重さは正規分布<span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mo stretchy=false >(</mo><mi>μ</mi><mo separator=true >,</mo><msup><mi>σ</mi><mn>2</mn></msup><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">N(μ,σ^2)</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1.064108em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class=mopen >(</span><span class="mord mathnormal">μ</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class=mclose >)</span></span></span></span>に従っているとする。 <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>μ</mi><mo separator=true >,</mo><msup><mi>σ</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">μ,σ^2</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1.008548em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">μ</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span>の事前分布は無情報事前分布とする。</p> <h2 id="a_yが正確な値だった場合"><a href="#a_yが正確な値だった場合" class=header-anchor >&#40;a&#41; yが正確な値だった場合</a></h2> <p>y&#61;&#91;10, 10, 12, 11, 9&#93;と実際に観測されたとする。 本文p.65より</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mtext>µ</mtext><mi mathvariant=normal >∣</mi><msup><mi>σ</mi><mn>2</mn></msup><mo separator=true >,</mo><mi>y</mi><mo>∼</mo><mi>N</mi><mo stretchy=false >(</mo><mi>y</mi><mo separator=true >,</mo><msup><mi>σ</mi><mn>2</mn></msup><mi mathvariant=normal >/</mi><mi>n</mi><mo stretchy=false >)</mo><mi mathvariant=normal >.</mi></mrow><annotation encoding="application/x-tex"> µ|σ^2, y \sim N(y, σ^2/n). </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1.1141079999999999em;vertical-align:-0.25em;"></span><span class=mord >µ∣</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∼</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1.1141079999999999em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class=mord >/</span><span class="mord mathnormal">n</span><span class=mclose >)</span><span class=mord >.</span></span></span></span></span> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><msup><mi>σ</mi><mn>2</mn></msup><mi mathvariant=normal >∣</mi><mi>y</mi><mo>∼</mo><mtext>Inv-</mtext><msup><mi>χ</mi><mn>2</mn></msup><mo stretchy=false >(</mo><mi>n</mi><mtext>−</mtext><mn>1</mn><mo separator=true >,</mo><msup><mi>s</mi><mn>2</mn></msup><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex"> σ^2|y \sim \text{Inv-}χ^2(n − 1, s^2) </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1.1141079999999999em;vertical-align:-0.25em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class=mord >∣</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∼</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1.1141079999999999em;vertical-align:-0.25em;"></span><span class="mord text"><span class=mord >Inv-</span></span><span class=mord ><span class="mord mathnormal">χ</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class=mopen >(</span><span class="mord mathnormal">n</span><span class=mord >−1</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord ><span class="mord mathnormal">s</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class=mclose >)</span></span></span></span></span> <p>である。ここで<span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>s</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">s^2</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8141079999999999em;vertical-align:0em;"></span><span class=mord ><span class="mord mathnormal">s</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span>はサンプル分散である。</p> <pre><code class="julia hljs"><span class=hljs-keyword >using</span> Distributions, StatsPlots
y=[<span class=hljs-number >10</span>, <span class=hljs-number >10</span>, <span class=hljs-number >12</span>, <span class=hljs-number >11</span>, <span class=hljs-number >9</span>]
posterior_variance_a_dist = InverseGamma((length(y)-<span class=hljs-number >1</span>)//<span class=hljs-number >2</span>, <span class=hljs-number >1</span>//<span class=hljs-number >2</span>) * std(y)
plot(posterior_variance_a_dist, label=<span class=hljs-string >&quot;posterior variance&quot;</span>, yrotation=<span class=hljs-number >90</span>, xlim=(<span class=hljs-number >0</span>,<span class=hljs-number >4</span>))
savefig(joinpath(<span class=hljs-meta >@OUTPUT</span>, <span class=hljs-string >&quot;posterior_variance_a_dist.svg&quot;</span>))
<span class=hljs-literal >nothing</span></code></pre> <img src="/assets/pages/BDA3_Exercises3_10_5/code/output/posterior_variance_a_dist.svg" alt=""> <p>図は<span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>σ</mi><mn>2</mn></msup><mi mathvariant=normal >∣</mi><mi>y</mi><mo>∼</mo><mtext>Inv-</mtext><msup><mi>χ</mi><mn>2</mn></msup><mo stretchy=false >(</mo><mi>n</mi><mtext>−</mtext><mn>1</mn><mo separator=true >,</mo><msup><mi>s</mi><mn>2</mn></msup><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">σ^2|y \sim \text{Inv-}χ^2(n − 1, s^2)</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1.064108em;vertical-align:-0.25em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class=mord >∣</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∼</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1.064108em;vertical-align:-0.25em;"></span><span class="mord text"><span class=mord >Inv-</span></span><span class=mord ><span class="mord mathnormal">χ</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class=mopen >(</span><span class="mord mathnormal">n</span><span class=mord >−1</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord ><span class="mord mathnormal">s</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class=mclose >)</span></span></span></span>の確率密度関数である。 この時、μの事後分布は以下のようになる。</p> <pre><code class="julia hljs">posterior_variance_a = rand(posterior_variance_a_dist, <span class=hljs-number >10</span>)
posterior_mean_a_dist = Normal.(mean(y),posterior_variance_a)
plot(posterior_mean_a_dist, yrotation=<span class=hljs-number >90</span>)
savefig(joinpath(<span class=hljs-meta >@OUTPUT</span>, <span class=hljs-string >&quot;posterior_mean_a_dist.svg&quot;</span>))
posterior_variance_a</code></pre><pre><code class="plaintext hljs">10-element Vector{Float64}:
 0.44317395820070854
 0.2079420239077438
 0.5179739673225474
 0.3948739465593943
 2.3439437615331356
 1.1474145977958756
 0.382893376700611
 0.2394708571613967
 0.2644657222770382
 1.2236804846988694</code></pre> <p>この値は分散の事後分布から得られた値である。 <img src="/assets/pages/BDA3_Exercises3_10_5/code/output/posterior_mean_a_dist.svg" alt=""></p> <h2 id="b_yが四捨五入した値だった場合"><a href="#b_yが四捨五入した値だった場合" class=header-anchor >&#40;b&#41; yが四捨五入した値だった場合</a></h2> <p>μとσの事後分布は</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mi>p</mi><mo stretchy=false >(</mo><mi>μ</mi><mo separator=true >,</mo><msup><mi>σ</mi><mn>2</mn></msup><mi mathvariant=normal >∣</mi><mi>y</mi><mo stretchy=false >)</mo><mo>∝</mo><mi>p</mi><mo stretchy=false >(</mo><mi>μ</mi><mo separator=true >,</mo><msup><mi>σ</mi><mn>2</mn></msup><mo stretchy=false >)</mo><mi>p</mi><mo stretchy=false >(</mo><mi>y</mi><mi mathvariant=normal >∣</mi><mi>μ</mi><mo separator=true >,</mo><msup><mi>σ</mi><mn>2</mn></msup><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex"> p(μ,σ^2|y)∝p(μ,σ^2)p(y|μ,σ^2) </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1.1141079999999999em;vertical-align:-0.25em;"></span><span class="mord mathnormal">p</span><span class=mopen >(</span><span class="mord mathnormal">μ</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class=mord >∣</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∝</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1.1141079999999999em;vertical-align:-0.25em;"></span><span class="mord mathnormal">p</span><span class=mopen >(</span><span class="mord mathnormal">μ</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class=mclose >)</span><span class="mord mathnormal">p</span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=mord >∣</span><span class="mord mathnormal">μ</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class=mclose >)</span></span></span></span></span> <p>である。事前分布p&#40;μ,σ^2&#41;は無情報事前分布なので</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mi>p</mi><mo stretchy=false >(</mo><mi>μ</mi><mo separator=true >,</mo><msup><mi>σ</mi><mn>2</mn></msup><mo stretchy=false >)</mo><mo>=</mo><msup><mi>σ</mi><mrow><mo>−</mo><mn>2</mn></mrow></msup></mrow><annotation encoding="application/x-tex"> p(μ,σ^2)=σ^{-2} </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1.1141079999999999em;vertical-align:-0.25em;"></span><span class="mord mathnormal">p</span><span class=mopen >(</span><span class="mord mathnormal">μ</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.864108em;vertical-align:0em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.864108em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span></span> <p>である。</p> <p>yが10の時、考えうる値は9.5≤y&lt;10.5である。 yは正規分布に従っているので、この範囲内に入る確率は</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mi>p</mi><mo stretchy=false >(</mo><mi>y</mi><mi mathvariant=normal >∣</mi><mi>μ</mi><mo separator=true >,</mo><msup><mi>σ</mi><mn>2</mn></msup><mo stretchy=false >)</mo><mo>∝</mo><mi mathvariant=normal >Φ</mi><mo stretchy=false >(</mo><mfrac><mrow><msub><mi>y</mi><mi>i</mi></msub><mo>+</mo><mn>0.5</mn><mo>−</mo><mi>μ</mi></mrow><mi>σ</mi></mfrac><mo stretchy=false >)</mo><mo>−</mo><mi mathvariant=normal >Φ</mi><mo stretchy=false >(</mo><mfrac><mrow><msub><mi>y</mi><mi>i</mi></msub><mo>−</mo><mn>0.5</mn><mo>−</mo><mi>μ</mi></mrow><mi>σ</mi></mfrac><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex"> p(y|μ,σ^2)∝Φ(\frac{y_i+0.5-μ}{σ})-Φ(\frac{y_i-0.5-μ}{σ}) </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1.1141079999999999em;vertical-align:-0.25em;"></span><span class="mord mathnormal">p</span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=mord >∣</span><span class="mord mathnormal">μ</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∝</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:2.00744em;vertical-align:-0.686em;"></span><span class=mord >Φ</span><span class=mopen >(</span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.32144em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord >0.5</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal">μ</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:2.00744em;vertical-align:-0.686em;"></span><span class=mord >Φ</span><span class=mopen >(</span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.32144em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord >0.5</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal">μ</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mclose >)</span></span></span></span></span> <p>である。yがn個観測された場合は全てをかけて</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mi>p</mi><mo stretchy=false >(</mo><mi>y</mi><mi mathvariant=normal >∣</mi><mi>μ</mi><mo separator=true >,</mo><msup><mi>σ</mi><mn>2</mn></msup><mo stretchy=false >)</mo><mo>∝</mo><munderover><mo>∏</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mo stretchy=false >(</mo><mi mathvariant=normal >Φ</mi><mo stretchy=false >(</mo><mfrac><mrow><msub><mi>y</mi><mi>i</mi></msub><mo>+</mo><mn>0.5</mn><mo>−</mo><mi>μ</mi></mrow><mi>σ</mi></mfrac><mo stretchy=false >)</mo><mo>−</mo><mi mathvariant=normal >Φ</mi><mo stretchy=false >(</mo><mfrac><mrow><msub><mi>y</mi><mi>i</mi></msub><mo>−</mo><mn>0.5</mn><mo>−</mo><mi>μ</mi></mrow><mi>σ</mi></mfrac><mo stretchy=false >)</mo><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex"> p(y|μ,σ^2)∝\prod^n_{i=1}(Φ(\frac{y_i+0.5-μ}{σ})-Φ(\frac{y_i-0.5-μ}{σ})) </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1.1141079999999999em;vertical-align:-0.25em;"></span><span class="mord mathnormal">p</span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=mord >∣</span><span class="mord mathnormal">μ</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∝</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:2.929066em;vertical-align:-1.277669em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.6513970000000002em;"><span style="top:-1.872331em;margin-left:0em;"><span class=pstrut  style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.050005em;"><span class=pstrut  style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∏</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class=pstrut  style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:1.277669em;"><span></span></span></span></span></span><span class=mopen >(</span><span class=mord >Φ</span><span class=mopen >(</span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.32144em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord >0.5</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal">μ</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:2.00744em;vertical-align:-0.686em;"></span><span class=mord >Φ</span><span class=mopen >(</span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.32144em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord >0.5</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal">μ</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mclose >))</span></span></span></span></span> <p>となる。 &#40;3&#41;,&#40;4&#41;,&#40;6&#41;式より</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mi>p</mi><mo stretchy=false >(</mo><mi>μ</mi><mo separator=true >,</mo><msup><mi>σ</mi><mn>2</mn></msup><mi mathvariant=normal >∣</mi><mi>y</mi><mo stretchy=false >)</mo><mo>∝</mo><msup><mi>σ</mi><mrow><mo>−</mo><mn>2</mn></mrow></msup><munderover><mo>∏</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mo stretchy=false >(</mo><mi mathvariant=normal >Φ</mi><mo stretchy=false >(</mo><mfrac><mrow><msub><mi>y</mi><mi>i</mi></msub><mo>+</mo><mn>0.5</mn><mo>−</mo><mi>μ</mi></mrow><mi>σ</mi></mfrac><mo stretchy=false >)</mo><mo>−</mo><mi mathvariant=normal >Φ</mi><mo stretchy=false >(</mo><mfrac><mrow><msub><mi>y</mi><mi>i</mi></msub><mo>−</mo><mn>0.5</mn><mo>−</mo><mi>μ</mi></mrow><mi>σ</mi></mfrac><mo stretchy=false >)</mo><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex"> p(μ,σ^2|y)∝σ^{-2}\prod^n_{i=1}(Φ(\frac{y_i+0.5-μ}{σ})-Φ(\frac{y_i-0.5-μ}{σ})) </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1.1141079999999999em;vertical-align:-0.25em;"></span><span class="mord mathnormal">p</span><span class=mopen >(</span><span class="mord mathnormal">μ</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class=mord >∣</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∝</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:2.929066em;vertical-align:-1.277669em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.864108em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">2</span></span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.6513970000000002em;"><span style="top:-1.872331em;margin-left:0em;"><span class=pstrut  style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.050005em;"><span class=pstrut  style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∏</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class=pstrut  style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:1.277669em;"><span></span></span></span></span></span><span class=mopen >(</span><span class=mord >Φ</span><span class=mopen >(</span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.32144em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord >0.5</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal">μ</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:2.00744em;vertical-align:-0.686em;"></span><span class=mord >Φ</span><span class=mopen >(</span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.32144em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord >0.5</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal">μ</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mclose >))</span></span></span></span></span> <h1 id="c_aとbの分布の比較"><a href="#c_aとbの分布の比較" class=header-anchor >&#40;c&#41; &#40;a&#41;と&#40;b&#41;の分布の比較</a></h1> <p>横軸μ、縦軸logσの等高線で確率密度の分布を確認する。 縦軸はlogσなので、事前分布は<span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo stretchy=false >(</mo><mi>μ</mi><mo separator=true >,</mo><mi>log</mi><mo>⁡</mo><msup><mi>σ</mi><mn>2</mn></msup><mo stretchy=false >)</mo><mo>∝</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">p(μ,\log{σ^2})∝1</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1.064108em;vertical-align:-0.25em;"></span><span class="mord mathnormal">p</span><span class=mopen >(</span><span class="mord mathnormal">μ</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mop >lo<span style="margin-right:0.01389em;">g</span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∝</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.64444em;vertical-align:0em;"></span><span class=mord >1</span></span></span></span>となる。 計算はグリッド近似を用いて行う。</p> <pre><code class="julia hljs">log_likelihood_a(y,μ,σ)=sum(logpdf.(Normal(μ,σ),y))
<span class=hljs-keyword >function</span> likelihood_matrix_a(y,μ_range,logσ_range)
    m = log_likelihood_a.(<span class=hljs-built_in >Ref</span>(y),μ_range&#x27;,exp.(logσ_range))
    exp.(m .- maximum(m))
<span class=hljs-keyword >end</span>
μ_range=<span class=hljs-number >0</span>:<span class=hljs-number >5</span>//<span class=hljs-number >100</span>:<span class=hljs-number >20</span>
logσ_range=-<span class=hljs-number >2</span>:<span class=hljs-number >5</span>//<span class=hljs-number >100</span>:<span class=hljs-number >3</span>
contour_levels=[<span class=hljs-number >.0001</span>; <span class=hljs-number >.001</span>; <span class=hljs-number >.01</span>; <span class=hljs-number >.05</span>:<span class=hljs-number >.05</span>:<span class=hljs-number >.95</span>;]
matrix_a=likelihood_matrix_a(y,μ_range,logσ_range)
contour(μ_range, logσ_range, matrix_a, levels=contour_levels, title=<span class=hljs-string >&quot;Probability Distribution (a)&quot;</span>)
savefig(joinpath(<span class=hljs-meta >@OUTPUT</span>, <span class=hljs-string >&quot;contour_a.svg&quot;</span>))
<span class=hljs-literal >nothing</span></code></pre> <pre><code class="julia hljs"><span class=hljs-keyword >function</span> log_likelihood_b(y,μ,σ)
    normaldist=Normal(μ,σ)
    sum(log.(cdf(normaldist, y .+ <span class=hljs-number >0.5</span>) .- cdf(normaldist, y .- <span class=hljs-number >0.5</span>)))
<span class=hljs-keyword >end</span>
<span class=hljs-keyword >function</span> likelihood_matrix_b(y,μ_range,logσ_range)
    m = log_likelihood_b.(<span class=hljs-built_in >Ref</span>(y),μ_range&#x27;,exp.(logσ_range))
    exp.(m .- maximum(m))
<span class=hljs-keyword >end</span>
matrix_b=likelihood_matrix_b(y,μ_range,logσ_range)
contour(μ_range, logσ_range, matrix_b, levels=contour_levels, title=<span class=hljs-string >&quot;Probability Distribution (b)&quot;</span>)
savefig(joinpath(<span class=hljs-meta >@OUTPUT</span>, <span class=hljs-string >&quot;contour_b.svg&quot;</span>))
<span class=hljs-literal >nothing</span></code></pre> <p><img src="/assets/pages/BDA3_Exercises3_10_5/code/output/contour_a.svg" alt=""> <img src="/assets/pages/BDA3_Exercises3_10_5/code/output/contour_b.svg" alt=""></p> <p>この図は横軸μ、縦軸logσの確率密度の等高線である。 &#40;a&#41;と&#40;b&#41;を比較すると、&#40;b&#41;の方が分散が小さい方向に確率密度が傾いていることがわかる。</p> <p>統計量も確認する。</p> <pre><code class="julia hljs"><span class=hljs-keyword >using</span> StatsBase
μ_weight_a = sum(matrix_a,dims=<span class=hljs-number >1</span>)|&gt;vec
μ_quantile_a=wquantile(μ_range,μ_weight_a,[<span class=hljs-number >.025</span>,<span class=hljs-number >.975</span>])
σ_weight_a = sum(matrix_a,dims=<span class=hljs-number >2</span>)|&gt;vec
σ_quantile_a=wquantile(exp.(logσ_range),σ_weight_a,[<span class=hljs-number >.025</span>,<span class=hljs-number >.975</span>])

μ_weight_b = sum(matrix_b,dims=<span class=hljs-number >1</span>)|&gt;vec
μ_quantile_b=wquantile(μ_range,μ_weight_b,[<span class=hljs-number >.025</span>,<span class=hljs-number >.975</span>])
σ_weight_b = sum(matrix_b,dims=<span class=hljs-number >2</span>)|&gt;vec
σ_quantile_b=wquantile(exp.(logσ_range),σ_weight_b,[<span class=hljs-number >.025</span>,<span class=hljs-number >.975</span>])

csv=<span class=hljs-string >&quot;&quot;&quot;分位数,0.025,0.975
(a) μ,<span class=hljs-subst >$(join(round.(μ_quantile_a;digits=<span class=hljs-number >2</span>)</span>,&quot;,&quot;))
(b) μ,<span class=hljs-subst >$(join(round.(μ_quantile_b;digits=<span class=hljs-number >2</span>)</span>,&quot;,&quot;))
(a) σ,<span class=hljs-subst >$(join(round.(σ_quantile_a;digits=<span class=hljs-number >2</span>)</span>,&quot;,&quot;))
(b) σ,<span class=hljs-subst >$(join(round.(σ_quantile_b;digits=<span class=hljs-number >2</span>)</span>,&quot;,&quot;))&quot;&quot;&quot;</span>
write(joinpath(<span class=hljs-meta >@OUTPUT</span>,<span class=hljs-string >&quot;quantile.csv&quot;</span>), csv)
<span class=hljs-literal >nothing</span></code></pre><pre><code class="plaintext hljs">ArgumentError: Package StatsBase not found in current path.
- Run `import Pkg; Pkg.add(&quot;StatsBase&quot;)` to install the StatsBase package.
</code></pre> <p><span style="color:red;">// Table matching '/assets/pages/BDA3_Exercises3_10_5/code/output/quantile.csv' not found. //</span></p> <p>平均は四捨五入を考慮した場合としない場合で大きな変化はないが、 標準偏差は四捨五入を考慮した場合の方が小さくなっている。</p> <h2 id="d_四捨五入されていない実際の値"><a href="#d_四捨五入されていない実際の値" class=header-anchor >&#40;d&#41; 四捨五入されていない実際の値</a></h2> <p>四捨五入されていない実際の値をzとする。 5つの観測値yに対して、それぞれzが求められる。 μとσに関してグリッド近似しているので、そのグリッドをタプル&#40;μ, σ&#41;のマトリックスで作成する。</p> <pre><code class="julia hljs">μσ_matrix = tuple.(μ_range, exp.(logσ_range)&#x27;)
μσ_matrix[<span class=hljs-number >1</span>:<span class=hljs-number >3</span>,<span class=hljs-number >1</span>:<span class=hljs-number >3</span>]</code></pre><pre><code class="plaintext hljs">3×3 Matrix{Tuple{Rational{Int64}, Float64}}:
 (0//1, 0.135335)   (0//1, 0.142274)   (0//1, 0.149569)
 (1//20, 0.135335)  (1//20, 0.142274)  (1//20, 0.149569)
 (1//10, 0.135335)  (1//10, 0.142274)  (1//10, 0.149569)</code></pre> <pre><code class="julia hljs">μσ_sample = wsample(μσ_matrix, matrix_b&#x27;|&gt;vec)</code></pre><pre><code class="plaintext hljs">(207//20, 1.568312185490169)</code></pre>
<p>matrix<em>b&#39;はμσ</em>matrixに対応する確率密度である。 これを重み付きサンプリングすることで、確率密度を考慮してμとσの組み合わせを選ぶことができる。 これを元に正規分布を作成する。</p>
<pre><code class="julia hljs">Normal(μσ_sample...)</code></pre><pre><code class="plaintext hljs">Distributions.Normal{Float64}(μ=10.35, σ=1.568312185490169)</code></pre>
<p>z作成関数を定義する。</p>
<pre><code class="julia hljs"><span class=hljs-keyword >function</span> z(normal_dists, yi)
    n=length(normal_dists)
    lowers = cdf.(normal_dists, yi-<span class=hljs-number >0.5</span>)
    uppers = cdf.(normal_dists, yi+<span class=hljs-number >0.5</span>)
    quantile.(normal_dists, lowers .+ rand(n) .* (uppers .- lowers))
<span class=hljs-keyword >end</span>
z([Normal(μσ_sample...)], <span class=hljs-number >10</span>)</code></pre><pre><code class="plaintext hljs">1-element Vector{Float64}:
 10.008597872669055</code></pre>
<p>10の観測値に対して、四捨五入する前の値が出力されている。 μσ_matrixから5000サンプリングして、5つの観測値yに対応するzをそれぞれ5000個出力する。</p>
<pre><code class="julia hljs">μσ_samples = wsample(μσ_matrix,matrix_b&#x27;|&gt;vec,<span class=hljs-number >5000</span>)
normal_dists = [Normal(s...) <span class=hljs-keyword >for</span> s <span class=hljs-keyword >in</span> μσ_samples]
zs = z.(normal_dists|&gt;<span class=hljs-built_in >Ref</span>, y)
histogram(zs[<span class=hljs-number >1</span>])
savefig(joinpath(<span class=hljs-meta >@OUTPUT</span>, <span class=hljs-string >&quot;histogram.svg&quot;</span>))
<span class=hljs-literal >nothing</span></code></pre>
<img src="/assets/pages/BDA3_Exercises3_10_5/code/output/histogram.svg" alt="">
<p>正規分布のμが10.4付近にあると考えているので、一様分布にはなっていない。 <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy=false >(</mo><msub><mi>z</mi><mn>1</mn></msub><mo>−</mo><msub><mi>z</mi><mn>2</mn></msub><msup><mo stretchy=false >)</mo><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">(z_1-z_2)^2</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mopen >(</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.04398em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:1.064108em;vertical-align:-0.25em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.04398em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mclose ><span class=mclose >)</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span>の平均を計算すると</p>
<pre><code class="julia hljs">mean(abs2, (zs[<span class=hljs-number >1</span>] .- zs[<span class=hljs-number >2</span>]))</code></pre><pre><code class="plaintext hljs">0.16156252853964015</code></pre>
<p>となる。</p>
<div class=page-foot >
  <div class=copyright >
    &copy; dokudo91. Last modified: November 14, 2023. Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and the <a href="https://julialang.org">Julia programming language</a>.
  </div>
</div>
</div>