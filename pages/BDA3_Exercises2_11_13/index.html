<!doctype html> <html lang=ja > <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <link rel=stylesheet  href="/libs/katex/katex.min.css"> <link rel=stylesheet  href="/libs/highlight/github.min.css"> <meta name="twitter:card" content=summary > <meta name="twitter:title" content="Juliaの世界 |&gt; BDA3の2.11 Exercisesの13を解く"> <meta name="twitter:site" content="@dokudo91"> <meta name="twitter:description" content="BDA3の2.11 Exercisesの13を解く。"> <meta name="twitter:image" content="https://dokudo91.github.io/assets/ソフィーの世界.png"> <link rel=stylesheet  href="/css/franklin.css"> <link rel=stylesheet  href="/css/basic.css"> <link rel=icon  href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text x=%220%22 y=%2280%22 font-family=%22Arial%22 font-size=%2285%22>😀</text></svg>"> <title>BDA3の2.11 Exercisesの13を解く</title> <header> <div class=blog-name ><a href="/">Juliaの世界</a></div> </header> <div class=franklin-content ><p>BDA3の2.11 Exercisesの13を解く。 リンクは<a href="http://www.stat.columbia.edu/~gelman/book/">Bayesian Data Analysis</a>。</p> <h1 id=ol_start13_discrete_data ><a href="#ol_start13_discrete_data" class=header-anchor ><ol start=13 > <li><p>Discrete data</p> </ol> </a></h1> <h2 id="ポアソン分布の共役事前分布と事後分布"><a href="#ポアソン分布の共役事前分布と事後分布" class=header-anchor >ポアソン分布の共役事前分布と事後分布</a></h2> <p>本文p.43のPoisson modelの内容を復習する。</p> <p>y|θはポアソン分布Poisson&#40;θ&#41;に従う。確率密度関数は</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mi>p</mi><mo stretchy=false >(</mo><mi>y</mi><mi mathvariant=normal >∣</mi><mi>θ</mi><mo stretchy=false >)</mo><mo>=</mo><mfrac><mrow><msup><mi>θ</mi><mi>y</mi></msup><msup><mi>e</mi><mrow><mo>−</mo><mi>θ</mi></mrow></msup></mrow><mrow><mi>y</mi><mo stretchy=false >!</mo></mrow></mfrac></mrow><annotation encoding="application/x-tex"> p(y|θ)=\frac{θ^ye^{-θ}}{y!} </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">p</span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=mord >∣</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:2.406548em;vertical-align:-0.8804400000000001em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.5261079999999998em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=mclose >!</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span></span></span></span></span><span class=mord ><span class="mord mathnormal">e</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8491079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">θ</span></span></span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.8804400000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span> <p>である。観測データが<span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>=</mo><mo stretchy=false >(</mo><msub><mi>y</mi><mn>1</mn></msub><mo separator=true >,</mo><mi mathvariant=normal >.</mi><mi mathvariant=normal >.</mi><mi mathvariant=normal >.</mi><mo separator=true >,</mo><msub><mi>y</mi><mi>n</mi></msub><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">y=(y_1,...,y_n)</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mopen >(</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord >...</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mclose >)</span></span></span></span>と得られた時、確率密度関数は</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mi>p</mi><mo stretchy=false >(</mo><mi>y</mi><mi mathvariant=normal >∣</mi><mi>θ</mi><mo stretchy=false >)</mo><mo>=</mo><munderover><mo>∏</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mfrac><mn>1</mn><mrow><msub><mi>y</mi><mi>i</mi></msub><mo stretchy=false >!</mo></mrow></mfrac><msup><mi>θ</mi><msub><mi>y</mi><mi>i</mi></msub></msup><msup><mi>e</mi><mrow><mo>−</mo><mi>θ</mi></mrow></msup><mspace linebreak=newline ></mspace><mo>∝</mo><msup><mi>θ</mi><mrow><mi>t</mi><mo stretchy=false >(</mo><mi>y</mi><mo stretchy=false >)</mo></mrow></msup><msup><mi>e</mi><mrow><mo>−</mo><mi>n</mi><mi>θ</mi></mrow></msup></mrow><annotation encoding="application/x-tex"> p(y|θ)=\prod_{i=1}^n\frac{1}{y_i!}θ^{y_i}e^{-θ} \\ ∝ θ^{t(y)}e^{-nθ} </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">p</span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=mord >∣</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:2.929066em;vertical-align:-1.277669em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.6513970000000002em;"><span style="top:-1.872331em;margin-left:0em;"><span class=pstrut  style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.050005em;"><span class=pstrut  style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∏</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class=pstrut  style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:1.277669em;"><span></span></span></span></span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.32144em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mclose >!</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.8804400000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.714392em;"><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.03588em;margin-right:0.07142857142857144em;"><span class=pstrut  style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class=mord ><span class="mord mathnormal">e</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8991079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">θ</span></span></span></span></span></span></span></span></span></span><span class="mspace newline"></span><span class=base ><span class=strut  style="height:0.43056em;vertical-align:0em;"></span><span class=mrel >∝</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.938em;vertical-align:0em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class=mord ><span class="mord mathnormal">e</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8991079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">θ</span></span></span></span></span></span></span></span></span></span></span></span></span> <p>となる。ここで<span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo stretchy=false >(</mo><mi>y</mi><mo stretchy=false >)</mo><mo>=</mo><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></msubsup><msub><mi>y</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">t(y)=\sum_{i=1}^ny_i</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">t</span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1.104002em;vertical-align:-0.29971000000000003em;"></span><span class=mop ><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">∑</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.804292em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.29971000000000003em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>である。指数型分布族の形で表すと</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mi>p</mi><mo stretchy=false >(</mo><mi>y</mi><mi mathvariant=normal >∣</mi><mi>θ</mi><mo stretchy=false >)</mo><mo>∝</mo><msup><mi>e</mi><mrow><mi>t</mi><mo stretchy=false >(</mo><mi>y</mi><mo stretchy=false >)</mo><mrow><mi mathvariant=normal >l</mi><mi mathvariant=normal >o</mi><mi mathvariant=normal >g</mi></mrow><mi>θ</mi></mrow></msup><msup><mi>e</mi><mrow><mo>−</mo><mi>n</mi><mi>θ</mi></mrow></msup></mrow><annotation encoding="application/x-tex"> p(y|θ) ∝ e^{t(y)\mathrm{log}θ}e^{-nθ} </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">p</span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=mord >∣</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∝</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.938em;vertical-align:0em;"></span><span class=mord ><span class="mord mathnormal">e</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span><span class="mclose mtight">)</span><span class="mord mtight"><span class="mord mathrm mtight" style="margin-right:0.01389em;">log</span></span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">θ</span></span></span></span></span></span></span></span></span><span class=mord ><span class="mord mathnormal">e</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8991079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">θ</span></span></span></span></span></span></span></span></span></span></span></span></span> <p>となる。</p> <p>ガンマ分布はポアソン分布の共役事前分布である。 θ~Gamma&#40;α,β&#41;とする。確率密度関数は指数型分布族の形で表すと</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mi>p</mi><mo stretchy=false >(</mo><mi>θ</mi><mo stretchy=false >)</mo><mo>∝</mo><msup><mi>θ</mi><mrow><mi>α</mi><mo>−</mo><mn>1</mn></mrow></msup><msup><mi>e</mi><mrow><mo>−</mo><mi>β</mi><mi>θ</mi></mrow></msup><mo>=</mo><msup><mi>e</mi><mrow><mo stretchy=false >(</mo><mi>α</mi><mo>−</mo><mn>1</mn><mo stretchy=false >)</mo><mrow><mi mathvariant=normal >l</mi><mi mathvariant=normal >o</mi><mi mathvariant=normal >g</mi></mrow><mi>θ</mi></mrow></msup><msup><mi>e</mi><mrow><mo>−</mo><mi>β</mi><mi>θ</mi></mrow></msup></mrow><annotation encoding="application/x-tex"> p(θ)∝θ^{α-1}e^{-βθ}=e^{(α-1)\mathrm{log}θ}e^{-βθ} </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">p</span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∝</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.8991079999999999em;vertical-align:0em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.864108em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.0037em;">α</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class=mord ><span class="mord mathnormal">e</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8991079999999999em;"><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">βθ</span></span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.938em;vertical-align:0em;"></span><span class=mord ><span class="mord mathnormal">e</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.0037em;">α</span><span class="mbin mtight">−</span><span class="mord mtight">1</span><span class="mclose mtight">)</span><span class="mord mtight"><span class="mord mathrm mtight" style="margin-right:0.01389em;">log</span></span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">θ</span></span></span></span></span></span></span></span></span><span class=mord ><span class="mord mathnormal">e</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8991079999999999em;"><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">βθ</span></span></span></span></span></span></span></span></span></span></span></span></span> <p>である。事後分布p&#40;θ|y&#41;はベイズの定理より</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mi>p</mi><mo stretchy=false >(</mo><mi>θ</mi><mi mathvariant=normal >∣</mi><mi>y</mi><mo stretchy=false >)</mo><mo>∝</mo><mi>p</mi><mo stretchy=false >(</mo><mi>θ</mi><mo stretchy=false >)</mo><mi>p</mi><mo stretchy=false >(</mo><mi>y</mi><mi mathvariant=normal >∣</mi><mi>θ</mi><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex"> p(θ|y)∝p(θ)p(y|θ) </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">p</span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=mord >∣</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∝</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">p</span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=mclose >)</span><span class="mord mathnormal">p</span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=mord >∣</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=mclose >)</span></span></span></span></span> <p>なので、</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mi>p</mi><mo stretchy=false >(</mo><mi>θ</mi><mi mathvariant=normal >∣</mi><mi>y</mi><mo stretchy=false >)</mo><mo>∝</mo><msup><mi>e</mi><mrow><mo stretchy=false >(</mo><mi>α</mi><mo>−</mo><mn>1</mn><mo stretchy=false >)</mo><mrow><mi mathvariant=normal >l</mi><mi mathvariant=normal >o</mi><mi mathvariant=normal >g</mi></mrow><mi>θ</mi></mrow></msup><msup><mi>e</mi><mrow><mo>−</mo><mi>β</mi><mi>θ</mi></mrow></msup><msup><mi>e</mi><mrow><mi>t</mi><mo stretchy=false >(</mo><mi>y</mi><mo stretchy=false >)</mo><mrow><mi mathvariant=normal >l</mi><mi mathvariant=normal >o</mi><mi mathvariant=normal >g</mi></mrow><mi>θ</mi></mrow></msup><msup><mi>e</mi><mrow><mo>−</mo><mi>n</mi><mi>θ</mi></mrow></msup><mspace linebreak=newline ></mspace><mo>=</mo><msup><mi>e</mi><mrow><mo stretchy=false >(</mo><mi>α</mi><mo>+</mo><mi>t</mi><mo stretchy=false >(</mo><mi>y</mi><mo stretchy=false >)</mo><mo>−</mo><mn>1</mn><mo stretchy=false >)</mo><mrow><mi mathvariant=normal >l</mi><mi mathvariant=normal >o</mi><mi mathvariant=normal >g</mi></mrow><mi>θ</mi></mrow></msup><msup><mi>e</mi><mrow><mo>−</mo><mo stretchy=false >(</mo><mi>β</mi><mo>+</mo><mi>n</mi><mo stretchy=false >)</mo><mi>θ</mi></mrow></msup></mrow><annotation encoding="application/x-tex"> p(θ|y)∝e^{(α-1)\mathrm{log}θ}e^{-βθ}e^{t(y)\mathrm{log}θ}e^{-nθ} \\ =e^{(α+t(y)-1)\mathrm{log}θ}e^{-(β+n)θ} </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">p</span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=mord >∣</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∝</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.938em;vertical-align:0em;"></span><span class=mord ><span class="mord mathnormal">e</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.0037em;">α</span><span class="mbin mtight">−</span><span class="mord mtight">1</span><span class="mclose mtight">)</span><span class="mord mtight"><span class="mord mathrm mtight" style="margin-right:0.01389em;">log</span></span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">θ</span></span></span></span></span></span></span></span></span><span class=mord ><span class="mord mathnormal">e</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8991079999999999em;"><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">βθ</span></span></span></span></span></span></span></span></span><span class=mord ><span class="mord mathnormal">e</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span><span class="mclose mtight">)</span><span class="mord mtight"><span class="mord mathrm mtight" style="margin-right:0.01389em;">log</span></span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">θ</span></span></span></span></span></span></span></span></span><span class=mord ><span class="mord mathnormal">e</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8991079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">θ</span></span></span></span></span></span></span></span></span></span><span class="mspace newline"></span><span class=base ><span class=strut  style="height:0.36687em;vertical-align:0em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.938em;vertical-align:0em;"></span><span class=mord ><span class="mord mathnormal">e</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.0037em;">α</span><span class="mbin mtight">+</span><span class="mord mathnormal mtight">t</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span><span class="mclose mtight">)</span><span class="mbin mtight">−</span><span class="mord mtight">1</span><span class="mclose mtight">)</span><span class="mord mtight"><span class="mord mathrm mtight" style="margin-right:0.01389em;">log</span></span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">θ</span></span></span></span></span></span></span></span></span><span class=mord ><span class="mord mathnormal">e</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.05278em;">β</span><span class="mbin mtight">+</span><span class="mord mathnormal mtight">n</span><span class="mclose mtight">)</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">θ</span></span></span></span></span></span></span></span></span></span></span></span></span> <p>と計算できる。これはガンマ分布Gamma&#40;α&#43;t&#40;y&#41;, β&#43;n&#41;の形である。 <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo stretchy=false >(</mo><mi>y</mi><mo stretchy=false >)</mo><mo>=</mo><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></msubsup><msub><mi>y</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">t(y)=\sum_{i=1}^ny_i</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">t</span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1.104002em;vertical-align:-0.29971000000000003em;"></span><span class=mop ><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">∑</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.804292em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.29971000000000003em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>はポアソン分布の十分統計量であり、事後分布は個別の<span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">y_i</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.625em;vertical-align:-0.19444em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>に依存せず、その合計にのみ依存している。</p> <h2 id="a_致命的事故の事後予測分布tilde_yy"><a href="#a_致命的事故の事後予測分布tilde_yy" class=header-anchor >&#40;a&#41; 致命的事故の事後予測分布<span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent=true ><mi>y</mi><mo>~</mo></mover><mi mathvariant=normal >∣</mi><mi>y</mi></mrow><annotation encoding="application/x-tex">\tilde y|y</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.6678599999999999em;"><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span><span style="top:-3.35em;"><span class=pstrut  style="height:3em;"></span><span class=accent-body  style="left:-0.19444em;"><span class=mord >~</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.19444em;"><span></span></span></span></span></span><span class=mord >∣</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span></a></h2> <p>飛行機の致命的事故の表がある。</p> <pre><code class="julia hljs"><span class=hljs-keyword >using</span> DataFrames, CSV
io=<span class=hljs-built_in >IOBuffer</span>(<span class=hljs-string >&quot;&quot;&quot;
Year FatalAccidents PassengerDeaths DeathRate
1976 24 734 0.19
1977 25 516 0.12
1978 31 754 0.15
1979 31 877 0.16
1980 22 814 0.14
1981 21 362 0.06
1982 26 764 0.13
1983 20 809 0.13
1984 16 223 0.03
1985 22 1066 0.15
&quot;&quot;&quot;</span>)
df = CSV.File(io, delim = <span class=hljs-string >&#x27; &#x27;</span>, header=<span class=hljs-literal >true</span>) |&gt; DataFrame</code></pre><pre><code class="plaintext hljs">10×4 DataFrame
 Row │ Year   FatalAccidents  PassengerDeaths  DeathRate
     │ Int64  Int64           Int64            Float64
─────┼───────────────────────────────────────────────────
   1 │  1976              24              734       0.19
   2 │  1977              25              516       0.12
   3 │  1978              31              754       0.15
   4 │  1979              31              877       0.16
   5 │  1980              22              814       0.14
   6 │  1981              21              362       0.06
   7 │  1982              26              764       0.13
   8 │  1983              20              809       0.13
   9 │  1984              16              223       0.03
  10 │  1985              22             1066       0.15</code></pre> <p>致命的事故の数yはPoisson&#40;θ&#41;に従うとする。 θの事前分布を指定して、事後分布を解析する。</p> <h3 id="θの事後分布θy"><a href="#θの事後分布θy" class=header-anchor >θの事後分布θ|y</a></h3> <p>θの事前分布について何の情報も持っていないので、 <a href="../BDA3_Exercises2_11_12">Exercises 12</a>で求めたジェフェリーズ事前分布<span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo stretchy=false >(</mo><mi>θ</mi><mo stretchy=false >)</mo><mo>=</mo><msup><mi>θ</mi><mrow><mo>−</mo><mn>1</mn><mi mathvariant=normal >/</mi><mn>2</mn></mrow></msup></mrow><annotation encoding="application/x-tex">p(θ)=θ^{-1/2}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">p</span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.8879999999999999em;vertical-align:0em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8879999999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1/2</span></span></span></span></span></span></span></span></span></span></span></span>を使う。 <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo stretchy=false >(</mo><mi>θ</mi><mo stretchy=false >)</mo><mo>=</mo><msup><mi>θ</mi><mrow><mo>−</mo><mn>1</mn><mi mathvariant=normal >/</mi><mn>2</mn></mrow></msup></mrow><annotation encoding="application/x-tex">p(θ)=θ^{-1/2}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">p</span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.8879999999999999em;vertical-align:0em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8879999999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1/2</span></span></span></span></span></span></span></span></span></span></span></span>はGamma&#40;1/2, 0&#41;の形なので、共役事前分布となり、事後分布はGamma&#40;1/2&#43;t&#40;y&#41;, n&#41;となる。 事前分布<span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo stretchy=false >(</mo><mi>θ</mi><mo stretchy=false >)</mo><mo>=</mo><msup><mi>θ</mi><mrow><mo>−</mo><mn>1</mn><mi mathvariant=normal >/</mi><mn>2</mn></mrow></msup></mrow><annotation encoding="application/x-tex">p(θ)=θ^{-1/2}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">p</span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.8879999999999999em;vertical-align:0em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8879999999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1/2</span></span></span></span></span></span></span></span></span></span></span></span>は確率分布としては不適であるが、事後分布Gamma&#40;1/2&#43;t&#40;y&#41;, n&#41;は解析可能である。</p> <pre><code class="julia hljs"><span class=hljs-keyword >using</span> Distributions, StatsPlots
n=length(df.FatalAccidents)
fa_rate_posterior_dist=Gamma(<span class=hljs-number >1</span>//<span class=hljs-number >2</span>+sum(df.FatalAccidents),<span class=hljs-number >1</span>//n)
plot(fa_rate_posterior_dist,yrotation=<span class=hljs-number >90</span>,label=<span class=hljs-string >&quot;θ_posterior&quot;</span>)
savefig(joinpath(<span class=hljs-meta >@OUTPUT</span>, <span class=hljs-string >&quot;fa_rate_posterior.svg&quot;</span>))
<span class=hljs-literal >nothing</span></code></pre> <img src="/assets/pages/BDA3_Exercises2_11_13/code/output/fa_rate_posterior.svg" alt=""> <p>Poisson&#40;θ&#41;に従う致命的事故の数yのθの事後分布の図である。 この事後分布は1976年から1985年までのFatalAccidentsの観測結果を用いて導かれた。</p> <h3 id="事後予測分布tilde_yy"><a href="#事後予測分布tilde_yy" class=header-anchor >事後予測分布<span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent=true ><mi>y</mi><mo>~</mo></mover><mi mathvariant=normal >∣</mi><mi>y</mi></mrow><annotation encoding="application/x-tex">\tilde y|y</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.6678599999999999em;"><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span><span style="top:-3.35em;"><span class=pstrut  style="height:3em;"></span><span class=accent-body  style="left:-0.19444em;"><span class=mord >~</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.19444em;"><span></span></span></span></span></span><span class=mord >∣</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span></a></h3> <p>事後予測分布<span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent=true ><mi>y</mi><mo>~</mo></mover><mi mathvariant=normal >∣</mi><mi>y</mi></mrow><annotation encoding="application/x-tex">\tilde y|y</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.6678599999999999em;"><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span><span style="top:-3.35em;"><span class=pstrut  style="height:3em;"></span><span class=accent-body  style="left:-0.19444em;"><span class=mord >~</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.19444em;"><span></span></span></span></span></span><span class=mord >∣</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span>の確率密度関数は</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mi>p</mi><mo stretchy=false >(</mo><mover accent=true ><mi>y</mi><mo>~</mo></mover><mi mathvariant=normal >∣</mi><mi>y</mi><mo stretchy=false >)</mo><mo>=</mo><mo>∫</mo><mi>p</mi><mo stretchy=false >(</mo><mover accent=true ><mi>y</mi><mo>~</mo></mover><mi mathvariant=normal >∣</mi><mi>θ</mi><mo stretchy=false >)</mo><mi>p</mi><mo stretchy=false >(</mo><mi>θ</mi><mi mathvariant=normal >∣</mi><mi>y</mi><mo stretchy=false >)</mo><mi>d</mi><mi>θ</mi></mrow><annotation encoding="application/x-tex"> p(\tilde y|y)=\int p(\tilde y|θ)p(θ|y)dθ </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">p</span><span class=mopen >(</span><span class="mord accent"><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.6678599999999999em;"><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span><span style="top:-3.35em;"><span class=pstrut  style="height:3em;"></span><span class=accent-body  style="left:-0.19444em;"><span class=mord >~</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.19444em;"><span></span></span></span></span></span><span class=mord >∣</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:2.22225em;vertical-align:-0.86225em;"></span><span class="mop op-symbol large-op" style="margin-right:0.44445em;position:relative;top:-0.0011249999999999316em;">∫</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">p</span><span class=mopen >(</span><span class="mord accent"><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.6678599999999999em;"><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span><span style="top:-3.35em;"><span class=pstrut  style="height:3em;"></span><span class=accent-body  style="left:-0.19444em;"><span class=mord >~</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.19444em;"><span></span></span></span></span></span><span class=mord >∣</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=mclose >)</span><span class="mord mathnormal">p</span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=mord >∣</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=mclose >)</span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span></span></span></span></span> <p>で計算される。ここでは、積分部分は単純化して和で計算する。</p> <pre><code class="julia hljs">fa_dists=[Poisson(θ) <span class=hljs-keyword >for</span> θ <span class=hljs-keyword >in</span> <span class=hljs-number >0</span>:<span class=hljs-number >0.1</span>:<span class=hljs-number >100</span>]
fa_rate_posterior_pdfs=[pdf(fa_rate_posterior_dist,θ) <span class=hljs-keyword >for</span> θ <span class=hljs-keyword >in</span> <span class=hljs-number >0</span>:<span class=hljs-number >0.1</span>:<span class=hljs-number >100</span>]
predictive_fa_pdf(y)=sum(pdf.(fa_dists,y) .* fa_rate_posterior_pdfs .* <span class=hljs-number >0.1</span>)
bar(<span class=hljs-number >1</span>:<span class=hljs-number >100</span>,predictive_fa_pdf,yrotation=<span class=hljs-number >90</span>,label=<span class=hljs-string >&quot;posterior predictive y&quot;</span>)
savefig(joinpath(<span class=hljs-meta >@OUTPUT</span>, <span class=hljs-string >&quot;predictive_fa_pdf.svg&quot;</span>))
<span class=hljs-literal >nothing</span></code></pre> <img src="/assets/pages/BDA3_Exercises2_11_13/code/output/predictive_fa_pdf.svg" alt=""> <p>分位数を計算する。</p> <pre><code class="julia hljs"><span class=hljs-keyword >function</span> fquantile(py,yvalues,q)
    index=findfirst(≥(q),cumsum([py(y) <span class=hljs-keyword >for</span> y <span class=hljs-keyword >in</span> yvalues]))
    getindex(yvalues,index)
<span class=hljs-keyword >end</span>
fquantile.(predictive_fa_pdf, <span class=hljs-built_in >Ref</span>(<span class=hljs-number >1</span>:<span class=hljs-number >100</span>), [<span class=hljs-number >.025</span>, <span class=hljs-number >.975</span>])</code></pre><pre><code class="plaintext hljs">2-element Vector{Int64}:
 14
 34</code></pre> <p>よって、95&#37;信用区間は&#91;14, 34&#93;である。 1986年に起こる致命的飛行機事故は95&#37;の確率で14回から34回である。</p> <h2 id="b_乗客の総飛行距離を考慮に入れて推測する"><a href="#b_乗客の総飛行距離を考慮に入れて推測する" class=header-anchor >&#40;b&#41; 乗客の総飛行距離を考慮に入れて推測する</a></h2> <p>全乗客の総飛行距離が増えれば飛行機事故は増えると考えられる。 この考えをベイズ推定に反映する。</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><msub><mi>y</mi><mi>i</mi></msub><mi mathvariant=normal >∣</mi><msub><mi>x</mi><mi>i</mi></msub><mo separator=true >,</mo><mi>θ</mi><mo>∼</mo><mrow><mi mathvariant=normal >P</mi><mi mathvariant=normal >o</mi><mi mathvariant=normal >i</mi><mi mathvariant=normal >s</mi><mi mathvariant=normal >s</mi><mi mathvariant=normal >o</mi><mi mathvariant=normal >n</mi></mrow><mo stretchy=false >(</mo><msub><mi>x</mi><mi>i</mi></msub><mi>θ</mi><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex"> y_i|x_i,θ \sim \mathrm{Poisson}(x_iθ) </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mord >∣</span><span class=mord ><span class="mord mathnormal">x</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∼</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mord ><span class="mord mathrm">Poisson</span></span><span class=mopen >(</span><span class=mord ><span class="mord mathnormal">x</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=mclose >)</span></span></span></span></span> <p><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">x_i</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.58056em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal">x</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>はi番目の年の全乗客の総飛行距離である。 致命的飛行機事故数<span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">y_i</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.625em;vertical-align:-0.19444em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>は<span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mi mathvariant=normal >P</mi><mi mathvariant=normal >o</mi><mi mathvariant=normal >i</mi><mi mathvariant=normal >s</mi><mi mathvariant=normal >s</mi><mi mathvariant=normal >o</mi><mi mathvariant=normal >n</mi></mrow><mo stretchy=false >(</mo><msub><mi>x</mi><mi>i</mi></msub><mi>θ</mi><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">\mathrm{Poisson}(x_iθ)</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mord ><span class="mord mathrm">Poisson</span></span><span class=mopen >(</span><span class=mord ><span class="mord mathnormal">x</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=mclose >)</span></span></span></span>に従うとする。 全乗客の総飛行距離<span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">x_i</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.58056em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal">x</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>は以下のように計算する。</p> <pre><code class="julia hljs">passenger_miles = df.PassengerDeaths ./ df.DeathRate .*<span class=hljs-number >10</span>^<span class=hljs-number >8</span>
df.PassengerMiles=passenger_miles
df</code></pre><pre><code class="plaintext hljs">10×5 DataFrame
 Row │ Year   FatalAccidents  PassengerDeaths  DeathRate  PassengerMiles
     │ Int64  Int64           Int64            Float64    Float64
─────┼───────────────────────────────────────────────────────────────────
   1 │  1976              24              734       0.19      3.86316e11
   2 │  1977              25              516       0.12      4.3e11
   3 │  1978              31              754       0.15      5.02667e11
   4 │  1979              31              877       0.16      5.48125e11
   5 │  1980              22              814       0.14      5.81429e11
   6 │  1981              21              362       0.06      6.03333e11
   7 │  1982              26              764       0.13      5.87692e11
   8 │  1983              20              809       0.13      6.22308e11
   9 │  1984              16              223       0.03      7.43333e11
  10 │  1985              22             1066       0.15      7.10667e11</code></pre> <p>DeathRateは１乗客、100マイルごとの死亡率であるので、死亡数を死亡率で割れば 全乗客の総飛行距離になる。</p> <h3 id="θの事後分布θyx"><a href="#θの事後分布θyx" class=header-anchor >θの事後分布θ|y,x</a></h3> <p>θの事前分布をGamma&#40;α, β&#41;とする。<span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mi>i</mi></msub><mi mathvariant=normal >∣</mi><msub><mi>x</mi><mi>i</mi></msub><mo separator=true >,</mo><mi>θ</mi><mo>∼</mo><mrow><mi mathvariant=normal >P</mi><mi mathvariant=normal >o</mi><mi mathvariant=normal >i</mi><mi mathvariant=normal >s</mi><mi mathvariant=normal >s</mi><mi mathvariant=normal >o</mi><mi mathvariant=normal >n</mi></mrow><mo stretchy=false >(</mo><msub><mi>x</mi><mi>i</mi></msub><mi>θ</mi><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">y_i|x_i,θ \sim \mathrm{Poisson}(x_iθ)</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mord >∣</span><span class=mord ><span class="mord mathnormal">x</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∼</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mord ><span class="mord mathrm">Poisson</span></span><span class=mopen >(</span><span class=mord ><span class="mord mathnormal">x</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=mclose >)</span></span></span></span>とした時、事後分布はどうなるか？ 指数型分布族の形にして計算する。</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mi>p</mi><mo stretchy=false >(</mo><msub><mi>y</mi><mi>i</mi></msub><mi mathvariant=normal >∣</mi><msub><mi>x</mi><mi>i</mi></msub><mo separator=true >,</mo><mi>θ</mi><mo stretchy=false >)</mo><mo>∝</mo><msup><mi>θ</mi><msub><mi>y</mi><mi>i</mi></msub></msup><msup><mi>e</mi><mrow><mo>−</mo><msub><mi>x</mi><mi>i</mi></msub><mi>θ</mi></mrow></msup></mrow><annotation encoding="application/x-tex"> p(y_i|x_i,θ)∝θ^{y_i}e^{-x_iθ} </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">p</span><span class=mopen >(</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mord >∣</span><span class=mord ><span class="mord mathnormal">x</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∝</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.899108em;vertical-align:0em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.714392em;"><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.03588em;margin-right:0.07142857142857144em;"><span class=pstrut  style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class=mord ><span class="mord mathnormal">e</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.899108em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight"><span class="mord mathnormal mtight">x</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class=pstrut  style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.143em;"><span></span></span></span></span></span></span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">θ</span></span></span></span></span></span></span></span></span></span></span></span></span> <p>全ての年の観測データを考慮して、</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mi>p</mi><mo stretchy=false >(</mo><mi>y</mi><mi mathvariant=normal >∣</mi><mi>x</mi><mo separator=true >,</mo><mi>θ</mi><mo stretchy=false >)</mo><mo>∝</mo><msup><mi>θ</mi><mrow><mi>t</mi><mo stretchy=false >(</mo><mi>y</mi><mo stretchy=false >)</mo></mrow></msup><msup><mi>e</mi><mrow><mo>−</mo><mi>t</mi><mo stretchy=false >(</mo><mi>x</mi><mo stretchy=false >)</mo><mi>θ</mi></mrow></msup><mo>=</mo><msup><mi>e</mi><mrow><mi>t</mi><mo stretchy=false >(</mo><mi>y</mi><mo stretchy=false >)</mo><mrow><mi mathvariant=normal >l</mi><mi mathvariant=normal >o</mi><mi mathvariant=normal >g</mi></mrow><mi>θ</mi></mrow></msup><msup><mi>e</mi><mrow><mo>−</mo><mi>t</mi><mo stretchy=false >(</mo><mi>x</mi><mo stretchy=false >)</mo><mi>θ</mi></mrow></msup></mrow><annotation encoding="application/x-tex"> p(y|x,θ)∝θ^{t(y)}e^{-t(x)θ}=e^{t(y)\mathrm{log}θ}e^{-t(x)θ} </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">p</span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=mord >∣</span><span class="mord mathnormal">x</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∝</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.938em;vertical-align:0em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class=mord ><span class="mord mathnormal">e</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mathnormal mtight">t</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">x</span><span class="mclose mtight">)</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">θ</span></span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.938em;vertical-align:0em;"></span><span class=mord ><span class="mord mathnormal">e</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span><span class="mclose mtight">)</span><span class="mord mtight"><span class="mord mathrm mtight" style="margin-right:0.01389em;">log</span></span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">θ</span></span></span></span></span></span></span></span></span><span class=mord ><span class="mord mathnormal">e</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mathnormal mtight">t</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">x</span><span class="mclose mtight">)</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">θ</span></span></span></span></span></span></span></span></span></span></span></span></span> <p>ここで、<span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo stretchy=false >(</mo><mi>y</mi><mo stretchy=false >)</mo><mo>=</mo><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></msubsup><msub><mi>y</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">t(y)=\sum_{i=1}^ny_i</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">t</span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1.104002em;vertical-align:-0.29971000000000003em;"></span><span class=mop ><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">∑</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.804292em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.29971000000000003em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>、<span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo stretchy=false >(</mo><mi>x</mi><mo stretchy=false >)</mo><mo>=</mo><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></msubsup><msub><mi>x</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">t(x)=\sum_{i=1}^nx_i</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">t</span><span class=mopen >(</span><span class="mord mathnormal">x</span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1.104002em;vertical-align:-0.29971000000000003em;"></span><span class=mop ><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">∑</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.804292em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.29971000000000003em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord ><span class="mord mathnormal">x</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>である。 θの事前分布をGamma&#40;α, β&#41;とすると</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mi>p</mi><mo stretchy=false >(</mo><mi>θ</mi><mo stretchy=false >)</mo><mo>∝</mo><msup><mi>θ</mi><mrow><mi>α</mi><mo>−</mo><mn>1</mn></mrow></msup><msup><mi>e</mi><mrow><mo>−</mo><mi>β</mi><mi>θ</mi></mrow></msup><mo>=</mo><msup><mi>e</mi><mrow><mo stretchy=false >(</mo><mi>α</mi><mo>−</mo><mn>1</mn><mo stretchy=false >)</mo><mrow><mi mathvariant=normal >l</mi><mi mathvariant=normal >o</mi><mi mathvariant=normal >g</mi></mrow><mi>θ</mi></mrow></msup><msup><mi>e</mi><mrow><mo>−</mo><mi>β</mi><mi>θ</mi></mrow></msup></mrow><annotation encoding="application/x-tex"> p(θ)∝θ^{α-1}e^{-βθ}=e^{(α-1)\mathrm{log}θ}e^{-βθ} </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">p</span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∝</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.8991079999999999em;vertical-align:0em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.864108em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.0037em;">α</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class=mord ><span class="mord mathnormal">e</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8991079999999999em;"><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">βθ</span></span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.938em;vertical-align:0em;"></span><span class=mord ><span class="mord mathnormal">e</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.0037em;">α</span><span class="mbin mtight">−</span><span class="mord mtight">1</span><span class="mclose mtight">)</span><span class="mord mtight"><span class="mord mathrm mtight" style="margin-right:0.01389em;">log</span></span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">θ</span></span></span></span></span></span></span></span></span><span class=mord ><span class="mord mathnormal">e</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8991079999999999em;"><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">βθ</span></span></span></span></span></span></span></span></span></span></span></span></span> <p>事後分布<span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo stretchy=false >(</mo><mi>θ</mi><mi mathvariant=normal >∣</mi><mi>y</mi><mo separator=true >,</mo><mi>x</mi><mo stretchy=false >)</mo><mo>∝</mo><mi>p</mi><mo stretchy=false >(</mo><mi>θ</mi><mo stretchy=false >)</mo><mi>p</mi><mo stretchy=false >(</mo><mi>y</mi><mi mathvariant=normal >∣</mi><mi>x</mi><mo separator=true >,</mo><mi>θ</mi><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">p(θ|y,x)∝p(θ)p(y|x,θ)</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">p</span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=mord >∣</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">x</span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∝</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">p</span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=mclose >)</span><span class="mord mathnormal">p</span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=mord >∣</span><span class="mord mathnormal">x</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=mclose >)</span></span></span></span>は</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mi>p</mi><mo stretchy=false >(</mo><mi>θ</mi><mi mathvariant=normal >∣</mi><mi>y</mi><mo separator=true >,</mo><mi>x</mi><mo stretchy=false >)</mo><mo>∝</mo><msup><mi>e</mi><mrow><mo stretchy=false >(</mo><mi>α</mi><mo>+</mo><mi>t</mi><mo stretchy=false >(</mo><mi>y</mi><mo stretchy=false >)</mo><mo>−</mo><mn>1</mn><mo stretchy=false >)</mo><mrow><mi mathvariant=normal >l</mi><mi mathvariant=normal >o</mi><mi mathvariant=normal >g</mi></mrow><mi>θ</mi></mrow></msup><msup><mi>e</mi><mrow><mo>−</mo><mo stretchy=false >(</mo><mi>β</mi><mo>+</mo><mi>t</mi><mo stretchy=false >(</mo><mi>x</mi><mo stretchy=false >)</mo><mo stretchy=false >)</mo><mi>θ</mi></mrow></msup></mrow><annotation encoding="application/x-tex"> p(θ|y,x)∝e^{(α+t(y)-1)\mathrm{log}θ}e^{-(β+t(x))θ} </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">p</span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=mord >∣</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">x</span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∝</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.938em;vertical-align:0em;"></span><span class=mord ><span class="mord mathnormal">e</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.0037em;">α</span><span class="mbin mtight">+</span><span class="mord mathnormal mtight">t</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span><span class="mclose mtight">)</span><span class="mbin mtight">−</span><span class="mord mtight">1</span><span class="mclose mtight">)</span><span class="mord mtight"><span class="mord mathrm mtight" style="margin-right:0.01389em;">log</span></span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">θ</span></span></span></span></span></span></span></span></span><span class=mord ><span class="mord mathnormal">e</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.05278em;">β</span><span class="mbin mtight">+</span><span class="mord mathnormal mtight">t</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">x</span><span class="mclose mtight">))</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">θ</span></span></span></span></span></span></span></span></span></span></span></span></span> <p>である。したがって事後分布はGamma&#40;α&#43;t&#40;y&#41;, β&#43;t&#40;x&#41;&#41;である。</p> <p>事前分布をGamma&#40;1/2, 0&#41;とすると事後分布はGamma&#40;1/2&#43;t&#40;y&#41;, t&#40;x&#41;&#41;である。 JuliaではGamma&#40;α, 1/β&#41;となっているので、注意する。</p> <pre><code class="julia hljs"><span class=hljs-keyword >using</span> Printf
b_posterior_dist=Gamma(<span class=hljs-number >1</span>//<span class=hljs-number >2</span>+sum(df.FatalAccidents),<span class=hljs-number >1</span>/sum(passenger_miles))
plot(b_posterior_dist,yrotation=<span class=hljs-number >90</span>,label=<span class=hljs-string >&quot;Gamma(<span class=hljs-subst >$(shape(b_posterior_dist)</span>), <span class=hljs-subst >$(<span class=hljs-meta >@sprintf</span>(<span class=hljs-string >&quot;%.2e&quot;</span>, scale(b_posterior_dist)</span>)))&quot;</span>)
savefig(joinpath(<span class=hljs-meta >@OUTPUT</span>, <span class=hljs-string >&quot;b_posterior_dist.svg&quot;</span>))
<span class=hljs-literal >nothing</span></code></pre> <img src="/assets/pages/BDA3_Exercises2_11_13/code/output/b_posterior_dist.svg" alt=""> <h3 id="事後予測分布tilde_yyx"><a href="#事後予測分布tilde_yyx" class=header-anchor >事後予測分布<span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent=true ><mi>y</mi><mo>~</mo></mover><mi mathvariant=normal >∣</mi><mi>y</mi><mo separator=true >,</mo><mi>x</mi></mrow><annotation encoding="application/x-tex">\tilde y|y,x</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.6678599999999999em;"><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span><span style="top:-3.35em;"><span class=pstrut  style="height:3em;"></span><span class=accent-body  style="left:-0.19444em;"><span class=mord >~</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.19444em;"><span></span></span></span></span></span><span class=mord >∣</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">x</span></span></span></span></a></h3> <p>データにない1986年の致命的飛行機事故数<span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent=true ><mi>y</mi><mo>~</mo></mover><mi mathvariant=normal >∣</mi><mi>y</mi><mo separator=true >,</mo><mi>x</mi></mrow><annotation encoding="application/x-tex">\tilde y|y,x</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.6678599999999999em;"><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span><span style="top:-3.35em;"><span class=pstrut  style="height:3em;"></span><span class=accent-body  style="left:-0.19444em;"><span class=mord >~</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.19444em;"><span></span></span></span></span></span><span class=mord >∣</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">x</span></span></span></span>を推定する。 ここで1986年の全乗客の総飛行距離xは<span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>8</mn><mo>∗</mo><mn>1</mn><msup><mn>0</mn><mn>11</mn></msup></mrow><annotation encoding="application/x-tex">8*10^{11}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.64444em;vertical-align:0em;"></span><span class=mord >8</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >∗</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:0.8141079999999999em;vertical-align:0em;"></span><span class=mord >1</span><span class=mord ><span class=mord >0</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">11</span></span></span></span></span></span></span></span></span></span></span></span>マイルとする。</p> <pre><code class="julia hljs">θrange=<span class=hljs-number >1e-11</span>:<span class=hljs-number >1e-13</span>:<span class=hljs-number >1e-10</span>
b_fa_dists=[Poisson(<span class=hljs-number >8</span>*<span class=hljs-number >10</span>^<span class=hljs-number >11</span>*θ) <span class=hljs-keyword >for</span> θ <span class=hljs-keyword >in</span> θrange]
b_posterior_pdfs=[pdf(b_posterior_dist,θ) <span class=hljs-keyword >for</span> θ <span class=hljs-keyword >in</span> θrange]
predictive_fa_pdf(y)=sum(pdf.(b_fa_dists,y) .* b_posterior_pdfs .* <span class=hljs-number >1e-13</span>)
bar(<span class=hljs-number >0</span>:<span class=hljs-number >100</span>,predictive_fa_pdf,yrotation=<span class=hljs-number >90</span>,label=<span class=hljs-string >&quot;predictive_fa_pdf&quot;</span>)
savefig(joinpath(<span class=hljs-meta >@OUTPUT</span>, <span class=hljs-string >&quot;predictive_fa_pdf.svg&quot;</span>))
<span class=hljs-literal >nothing</span></code></pre> <img src="/assets/pages/BDA3_Exercises2_11_13/code/output/predictive_fa_pdf.svg" alt=""> <p>図は事後予測分布<span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent=true ><mi>y</mi><mo>~</mo></mover><mi mathvariant=normal >∣</mi><mi>y</mi><mo separator=true >,</mo><mi>x</mi></mrow><annotation encoding="application/x-tex">\tilde y|y,x</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.6678599999999999em;"><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span><span style="top:-3.35em;"><span class=pstrut  style="height:3em;"></span><span class=accent-body  style="left:-0.19444em;"><span class=mord >~</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.19444em;"><span></span></span></span></span></span><span class=mord >∣</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">x</span></span></span></span>の確率質量関数である。</p> <pre><code class="julia hljs">fquantile.(predictive_fa_pdf, <span class=hljs-built_in >Ref</span>(<span class=hljs-number >0</span>:<span class=hljs-number >100</span>), [<span class=hljs-number >.025</span>, <span class=hljs-number >.975</span>])</code></pre><pre><code class="plaintext hljs">2-element Vector{Int64}:
 22
 46</code></pre> <p>95&#37;信用区間は&#91;22, 46&#93;である。 &#40;a&#41;では&#91;14, 34&#93;と推測したので、飛行機事故数は多くなる方向にシフトしている。 &#40;b&#41;では飛行距離が増えれば飛行機事故が増えると考えており、結果だけ見るとその仮定は正しそうである。</p> <h2 id="c_aの条件で乗客死亡者数をyとする"><a href="#c_aの条件で乗客死亡者数をyとする" class=header-anchor >&#40;c&#41; &#40;a&#41;の条件で乗客死亡者数をyとする</a></h2> <p>&#40;a&#41;の条件で乗客死亡者数をyとして推測する。</p> <h3 id="θの事後分布θy__2"><a href="#θの事後分布θy__2" class=header-anchor >θの事後分布θ|y</a></h3> <pre><code class="julia hljs">df</code></pre><pre><code class="plaintext hljs">10×5 DataFrame
 Row │ Year   FatalAccidents  PassengerDeaths  DeathRate  PassengerMiles
     │ Int64  Int64           Int64            Float64    Float64
─────┼───────────────────────────────────────────────────────────────────
   1 │  1976              24              734       0.19      3.86316e11
   2 │  1977              25              516       0.12      4.3e11
   3 │  1978              31              754       0.15      5.02667e11
   4 │  1979              31              877       0.16      5.48125e11
   5 │  1980              22              814       0.14      5.81429e11
   6 │  1981              21              362       0.06      6.03333e11
   7 │  1982              26              764       0.13      5.87692e11
   8 │  1983              20              809       0.13      6.22308e11
   9 │  1984              16              223       0.03      7.43333e11
  10 │  1985              22             1066       0.15      7.10667e11</code></pre> <pre><code class="julia hljs">n=length(df.PassengerDeaths)
c_posterior_dist=Gamma(<span class=hljs-number >1</span>//<span class=hljs-number >2</span>+sum(df.PassengerDeaths),<span class=hljs-number >1</span>//n)
plot(c_posterior_dist,yrotation=<span class=hljs-number >90</span>,label=<span class=hljs-string >&quot;c_posterior_dist&quot;</span>,xlim=(<span class=hljs-number >500</span>,<span class=hljs-number >1000</span>))
savefig(joinpath(<span class=hljs-meta >@OUTPUT</span>, <span class=hljs-string >&quot;c_posterior_dist.svg&quot;</span>))
<span class=hljs-literal >nothing</span></code></pre> <img src="/assets/pages/BDA3_Exercises2_11_13/code/output/c_posterior_dist.svg" alt=""> <h3 id="事後予測分布tilde_yy__2"><a href="#事後予測分布tilde_yy__2" class=header-anchor >事後予測分布<span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent=true ><mi>y</mi><mo>~</mo></mover><mi mathvariant=normal >∣</mi><mi>y</mi></mrow><annotation encoding="application/x-tex">\tilde y|y</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.6678599999999999em;"><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span><span style="top:-3.35em;"><span class=pstrut  style="height:3em;"></span><span class=accent-body  style="left:-0.19444em;"><span class=mord >~</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.19444em;"><span></span></span></span></span></span><span class=mord >∣</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span></a></h3> <pre><code class="julia hljs">crange=<span class=hljs-number >600</span>:<span class=hljs-number >0.1</span>:<span class=hljs-number >800</span>
c_dists=[Poisson(θ) <span class=hljs-keyword >for</span> θ <span class=hljs-keyword >in</span> crange]
c_posterior_pdfs=[pdf(c_posterior_dist,θ) <span class=hljs-keyword >for</span> θ <span class=hljs-keyword >in</span> crange]
c_predictive_pdf(y)=sum(pdf.(c_dists,y) .* c_posterior_pdfs .* <span class=hljs-number >0.1</span>)
bar(<span class=hljs-number >500</span>:<span class=hljs-number >1200</span>,c_predictive_pdf,yrotation=<span class=hljs-number >90</span>,label=<span class=hljs-string >&quot;c_predictive_pdf&quot;</span>)
savefig(joinpath(<span class=hljs-meta >@OUTPUT</span>, <span class=hljs-string >&quot;c_predictive_pdf.svg&quot;</span>))
<span class=hljs-literal >nothing</span></code></pre> <img src="/assets/pages/BDA3_Exercises2_11_13/code/output/c_predictive_pdf.svg" alt=""> <p>分位数を計算する。</p> <pre><code class="julia hljs">fquantile.(c_predictive_pdf, <span class=hljs-built_in >Ref</span>(<span class=hljs-number >500</span>:<span class=hljs-number >1200</span>), [<span class=hljs-number >.025</span>, <span class=hljs-number >.975</span>])</code></pre><pre><code class="plaintext hljs">2-element Vector{Int64}:
 638
 747</code></pre> <p>95&#37;信用区間は&#91;638, 747&#93;である。</p> <h2 id="d_bの条件で乗客死亡者数をyとする"><a href="#d_bの条件で乗客死亡者数をyとする" class=header-anchor >&#40;d&#41; &#40;b&#41;の条件で乗客死亡者数をyとする</a></h2> <pre><code class="julia hljs">d_posterior_dist=Gamma(<span class=hljs-number >1</span>//<span class=hljs-number >2</span>+sum(df.PassengerDeaths),<span class=hljs-number >1</span>/sum(passenger_miles))
plot(d_posterior_dist,yrotation=<span class=hljs-number >90</span>,label=<span class=hljs-string >&quot;d_posterior_dist&quot;</span>)
savefig(joinpath(<span class=hljs-meta >@OUTPUT</span>, <span class=hljs-string >&quot;d_posterior_dist.svg&quot;</span>))
<span class=hljs-literal >nothing</span></code></pre> <img src="/assets/pages/BDA3_Exercises2_11_13/code/output/d_posterior_dist.svg" alt=""> <h3 id="事後予測分布tilde_yyx__2"><a href="#事後予測分布tilde_yyx__2" class=header-anchor >事後予測分布<span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent=true ><mi>y</mi><mo>~</mo></mover><mi mathvariant=normal >∣</mi><mi>y</mi><mo separator=true >,</mo><mi>x</mi></mrow><annotation encoding="application/x-tex">\tilde y|y,x</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.6678599999999999em;"><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span><span style="top:-3.35em;"><span class=pstrut  style="height:3em;"></span><span class=accent-body  style="left:-0.19444em;"><span class=mord >~</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.19444em;"><span></span></span></span></span></span><span class=mord >∣</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">x</span></span></span></span></a></h3> <pre><code class="julia hljs">dθrange=<span class=hljs-number >1e-9</span>:<span class=hljs-number >1e-12</span>:<span class=hljs-number >2e-9</span>
d_pd_dists=[Poisson(<span class=hljs-number >8</span>*<span class=hljs-number >10</span>^<span class=hljs-number >11</span>*θ) <span class=hljs-keyword >for</span> θ <span class=hljs-keyword >in</span> dθrange]
d_posterior_pdfs=[pdf(d_posterior_dist,θ) <span class=hljs-keyword >for</span> θ <span class=hljs-keyword >in</span> dθrange]
d_predictive_pd_pdf(y)=sum(pdf.(d_pd_dists,y) .* d_posterior_pdfs .* <span class=hljs-number >1e-12</span>)
bar(<span class=hljs-number >500</span>:<span class=hljs-number >1200</span>,d_predictive_pd_pdf,yrotation=<span class=hljs-number >90</span>,label=<span class=hljs-string >&quot;d_predictive_pd_pdf&quot;</span>)
savefig(joinpath(<span class=hljs-meta >@OUTPUT</span>, <span class=hljs-string >&quot;d_predictive_pd_pdf.svg&quot;</span>))
<span class=hljs-literal >nothing</span></code></pre> <img src="/assets/pages/BDA3_Exercises2_11_13/code/output/d_predictive_pd_pdf.svg" alt=""> <pre><code class="julia hljs">fquantile.(d_predictive_pd_pdf, <span class=hljs-built_in >Ref</span>(<span class=hljs-number >500</span>:<span class=hljs-number >1200</span>), [<span class=hljs-number >.025</span>, <span class=hljs-number >.975</span>])</code></pre><pre><code class="plaintext hljs">2-element Vector{Int64}:
  904
 1034</code></pre> <p>95&#37;信用区間は&#91;904, 1034&#93;である。</p> <h2 id="e_a-dの分析の妥当性"><a href="#e_a-dの分析の妥当性" class=header-anchor >&#40;e&#41; &#40;a&#41;-&#40;d&#41;の分析の妥当性</a></h2> <p>飛行距離が増えれば死亡事故が増えると考えるのは妥当である。 しかし、年を追うごとに技術の発展や業務の改善がなされ、死亡事故は減ることも考えられる。 &#40;b&#41;、&#40;d&#41;は飛行距離しか考えていないので、最新の年の死亡数が最も高くなると予測しているが、 実際には1986年の事故は22件、死亡者数は546人であった。 このモデル化に関してはExercises 3.12, 6.2, 6.3, 8.14でも再検討を行う。</p> <div class=page-foot > <div class=copyright > &copy; dokudo91. Last modified: November 14, 2023. Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and the <a href="https://julialang.org">Julia programming language</a>. </div> </div> </div>