<!doctype html> <html lang=ja > <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <link rel=stylesheet  href="/libs/katex/katex.min.css"> <link rel=stylesheet  href="/libs/highlight/github.min.css"> <meta name="twitter:card" content=summary > <meta name="twitter:title" content="Juliaの世界 |&gt; Law of total varianceをJuliaで検証する"> <meta name="twitter:site" content="@dokudo91"> <meta name="twitter:description" content="Law of total varianceを男女の身長の分布を例に確認した。"> <meta name="twitter:image" content="https://dokudo91.github.io/assets/ソフィーの世界.png"> <link rel=stylesheet  href="/css/franklin.css"> <link rel=stylesheet  href="/css/basic.css"> <link rel=icon  href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text x=%220%22 y=%2280%22 font-family=%22Arial%22 font-size=%2285%22>😀</text></svg>"> <title>Law of total varianceをJuliaで検証する</title> <header> <div class=blog-name ><a href="/">Juliaの世界</a></div> </header> <div class=franklin-content >Law of total varianceを男女の身長の分布を例に確認した。 <h1 id=law_of_total_variance ><a href="#law_of_total_variance" class=header-anchor >Law of total variance</a></h1> <p>Law of total varianceは以下の式である。</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mi>V</mi><mi>a</mi><mi>r</mi><mo stretchy=false >(</mo><mi>Y</mi><mo stretchy=false >)</mo><mo>=</mo><mi>V</mi><mi>a</mi><mi>r</mi><mo stretchy=false >(</mo><mi>E</mi><mo stretchy=false >[</mo><mi>Y</mi><mo>∣</mo><mi>X</mi><mo stretchy=false >]</mo><mo stretchy=false >)</mo><mo>+</mo><mi>E</mi><mo stretchy=false >[</mo><mi>V</mi><mi>a</mi><mi>r</mi><mo stretchy=false >(</mo><mi>Y</mi><mo>∣</mo><mi>X</mi><mo stretchy=false >)</mo><mo stretchy=false >]</mo></mrow><annotation encoding="application/x-tex"> Var(Y)=Var(E[Y∣X])+E[Var(Y∣X)] </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">Va</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">Va</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class=mopen >[</span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∣</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class=mclose >])</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class=mopen >[</span><span class="mord mathnormal">Va</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∣</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class=mclose >)]</span></span></span></span></span> <h2 id="具体例_男女の身長の分布"><a href="#具体例_男女の身長の分布" class=header-anchor >具体例： 男女の身長の分布</a></h2> <p>Xは0から1の一様分布。Yは男女合わせた身長とする。 男の身長は平均170、標準偏差10の正規分布に従うとし、女の身長は平均160、標準偏差5の正規分布に従うとする。 Yの分布は男の分布と女の分布を6:4で混ぜ合わせた分布とする。サンプルは0≤X&lt;0.6であれば男の分布に0.6≤X≤1であれば女の分布に属するとする。</p> <pre><code class="julia hljs"><span class=hljs-keyword >using</span> Distributions, StatsPlots
μm = <span class=hljs-number >170</span>
σm = <span class=hljs-number >10</span>
μf = <span class=hljs-number >160</span>
σf = <span class=hljs-number >5</span>

dist_male = Normal(μm, σm)
dist_female = Normal(μf, σf)

Y = MixtureModel([dist_male, dist_female], [<span class=hljs-number >0.6</span>, <span class=hljs-number >0.4</span>])
plot(Y, label=[<span class=hljs-string >&quot;male PDF&quot;</span> <span class=hljs-string >&quot;female PDF&quot;</span>], yrotation=<span class=hljs-number >90</span>)
plot!(x-&gt;pdf(Y,x), label=<span class=hljs-string >&quot;Mixture PDF&quot;</span>)
savefig(joinpath(<span class=hljs-meta >@OUTPUT</span>, <span class=hljs-string >&quot;LawOfTotalVariance.svg&quot;</span>))
<span class=hljs-literal >nothing</span></code></pre><pre><code class="plaintext hljs">Failed to precompile StatsPlots [f3b207a7-027a-5e70-b257-86293d7955fd] to &quot;/home/runner/.julia/compiled/v1.9/StatsPlots/jl_Ebjj6R&quot;.
</code></pre> <p><span style="color:red;">// Image matching '/assets/pages/LawOfTotalVariance/code/LawOfTotalVariance' not found. //</span></p> <p>Distributionsパッケージを使って混合モデルを作っている。この混合モデルの分散をLaw of total varianceで計算する。 Yから取り出したサンプルは0.6の確率でμm&#61;170の、0.4の確率でμf&#61;160の分布に含まれる。Yから取り出したサンプルの平均の分散Var&#40;E&#91;Y&#93;&#41;は</p> <pre><code class="julia hljs">Var_E_Y = [(μm - mean(Y))^<span class=hljs-number >2</span>, (μf - mean(Y))^<span class=hljs-number >2</span>]</code></pre><pre><code class="plaintext hljs">UndefVarError: `μm` not defined
</code></pre> <p>0.6の確率で16、0.4の確率で36となる。従って</p> <pre><code class="julia hljs">Var_E_Y_given_X = <span class=hljs-number >0.6</span> * Var_E_Y[<span class=hljs-number >1</span>] + <span class=hljs-number >0.4</span> * Var_E_Y[<span class=hljs-number >2</span>]</code></pre><pre><code class="plaintext hljs">UndefVarError: `Var_E_Y` not defined
</code></pre> <p><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><mi>a</mi><mi>r</mi><mo stretchy=false >(</mo><mi>E</mi><mo stretchy=false >[</mo><mi>Y</mi><mi mathvariant=normal >∣</mi><mi>X</mi><mo stretchy=false >]</mo><mo stretchy=false >)</mo><mo>=</mo><mn>24</mn></mrow><annotation encoding="application/x-tex">Var(E[Y|X])=24</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">Va</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class=mopen >[</span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class=mord >∣</span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class=mclose >])</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.64444em;vertical-align:0em;"></span><span class=mord >24</span></span></span></span>となる。Yの分散は</p> <pre><code class="julia hljs">Var_Y=[σm^<span class=hljs-number >2</span>, σf^<span class=hljs-number >2</span>]</code></pre><pre><code class="plaintext hljs">UndefVarError: `σm` not defined
</code></pre> <p>0.6の確率で100であり、0.4の確率で25である。その期待値は</p> <pre><code class="julia hljs">E_Var_Y_given_X = <span class=hljs-number >0.6</span> * Var_Y[<span class=hljs-number >1</span>] + <span class=hljs-number >0.4</span> * Var_Y[<span class=hljs-number >2</span>]</code></pre><pre><code class="plaintext hljs">UndefVarError: `Var_Y` not defined
</code></pre> <p><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mo stretchy=false >[</mo><mi>V</mi><mi>a</mi><mi>r</mi><mo stretchy=false >(</mo><mi>Y</mi><mi mathvariant=normal >∣</mi><mi>X</mi><mo stretchy=false >)</mo><mo stretchy=false >]</mo><mo>=</mo><mn>70</mn></mrow><annotation encoding="application/x-tex">E[Var(Y|X)]=70</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class=mopen >[</span><span class="mord mathnormal">Va</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class=mord >∣</span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class=mclose >)]</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.64444em;vertical-align:0em;"></span><span class=mord >70</span></span></span></span>となる。 Law of total varianceより</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mi>V</mi><mi>a</mi><mi>r</mi><mo stretchy=false >(</mo><mi>Y</mi><mo stretchy=false >)</mo><mo>=</mo><mi>V</mi><mi>a</mi><mi>r</mi><mo stretchy=false >(</mo><mi>E</mi><mo stretchy=false >[</mo><mi>Y</mi><mo>∣</mo><mi>X</mi><mo stretchy=false >]</mo><mo stretchy=false >)</mo><mo>+</mo><mi>E</mi><mo stretchy=false >[</mo><mi>V</mi><mi>a</mi><mi>r</mi><mo stretchy=false >(</mo><mi>Y</mi><mo>∣</mo><mi>X</mi><mo stretchy=false >)</mo><mo stretchy=false >]</mo><mo>=</mo><mn>24</mn><mo>+</mo><mn>70</mn><mo>=</mo><mn>94</mn></mrow><annotation encoding="application/x-tex"> Var(Y)=Var(E[Y∣X])+E[Var(Y∣X)]=24+70=94 </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">Va</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">Va</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class=mopen >[</span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∣</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class=mclose >])</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class=mopen >[</span><span class="mord mathnormal">Va</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∣</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class=mclose >)]</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.72777em;vertical-align:-0.08333em;"></span><span class=mord >24</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:0.64444em;vertical-align:0em;"></span><span class=mord >70</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.64444em;vertical-align:0em;"></span><span class=mord >94</span></span></span></span></span> <p>MixtureModelは直接、分散を計算できるので値を確認する。</p> <pre><code class="julia hljs">var(Y)</code></pre><pre><code class="plaintext hljs">UndefVarError: `Y` not defined
</code></pre> <p>同じ値になっていることが確認できた。</p> <div class=page-foot > <div class=copyright > &copy; dokudo91. Last modified: September 28, 2023. Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and the <a href="https://julialang.org">Julia programming language</a>. </div> </div> </div>